---
title: Docker学习笔记
toc_number: true
tags:
  - 学习
  - Docker
categories:
  - - 技术
    - 后端
cover: 'https://cdn.inkdp.cn/img/20220530164429.png'
keywords: 'Docker, 容器'
description: >-
  Docker 是一个用于开发、发布和运行应用程序的开放平台。Docker 使您能够将应用程序与基础结构分离开来，从而可以快速交付软件。使用
  Docker，您可以像管理应用程序一样管理基础结构。通过利用 Docker
  的快速发布、测试和部署代码的方法，可以显著减少编写代码和在生产环境中运行代码之间的延迟。
abbrlink: 10048
date: 2022-06-01 01:59:28
updated: 2022-06-01 02:59:28
---


### 概述

Docker 是一个用于开发、发布和运行应用程序的开放平台。Docker 使您能够将应用程序与基础结构分离开来，从而可以快速交付软件。使用 Docker，您可以像管理应用程序一样管理基础结构。通过利用 Docker 的快速发布、测试和部署代码的方法，可以显著减少编写代码和在生产环境中运行代码之间的延迟。

#### docker是什么？

- Docker 是一个应用打包、分发、部署的工具
- 你也可以把它理解为一个轻量的虚拟机，它只虚拟你软件需要的运行环境，多余的一点都不要，
- 而普通虚拟机则是一个完整而庞大的系统，包含各种不管你要不要的软件。

官方解释：

Docker提供一个能力来打包和运行应用，在一个被称为容器的松散的孤立环境中。这种隔离和安全机制可以使你同时在一个主机上运行很多的容器。容器是轻量级，因为它们不需要额外的应用管理负载，直接在主机的内核当中运行。意味着可以在给定的硬件当中运行更多的容器（比虚拟机成本要低很多）。**甚至可以在虚拟机当中运行docker**！

提供了一个工具和平台来管理你的容器的生命周期:

- 使用容器开发应用及支持的组件
- 容器称为了一个单元用于发布和测试你的应用
- 准备发布的时候，作为一个容器或合理安排的服务，无论是产品环境还是云环境，都会是一致的

#### 跟普通虚拟机的对比

| 特性   | 普通虚拟机                                                   | Docker                                               |
| ------ | :----------------------------------------------------------- | ---------------------------------------------------- |
| 跨平台 | 通常只能在桌面级系统运行，例如 Windows/Mac，无法在不带图形界面的服务器上运行 | 支持的系统非常多，各类 windows 和 Linux 都支持       |
| 性能   | 性能损耗大，内存占用高，因为是把整个完整系统都虚拟出来了     | 性能好，只虚拟软件所需运行环境，最大化减少没用的配置 |
| 自动化 | 需要手动安装所有东西                                         | 一个命令就可以自动部署好所需环境                     |
| 兼容性 | 兼容性不高，不同系统差异大                                   | 兼容性好，不同系统都一样部署方式                     |

#### 可以用docker来做什么？

1. 快速，一致发布应用

   docker通过允许开发者在标准的环境使用本地容器提供应用和服务，来简单化开发生命周期。容器对于不断地集成（continuous integration）、发布（continuous delivery）（CI/CD）工作流是非常重要的！

2. 响应式部署

   docker基于容器的平台具有具有高度的可移植性的工作负载。docker 容器可以运行在开发者的本地笔记本、在数据中心的物理机或虚拟机当中、云环境或者混合环境等等。

   docker的可移植性和轻量级的特征可以使之很轻易地在真实环境当中，根据商业需要，动态地管理工作负载，按比例增加或减少应用服务 。

3. 运行更多的负载在相同的硬件中

   docker是一个轻量并且快速。相对于应用管理的虚拟机设备，提供了一个可见、成本低廉的选择，所以你可以更加充分地运行本的计算 能力以达到商业布标。docker更喜欢高密度环境用于小型、中型部署，这样可以用更少地资源做更多的事。

4. 快速安装测试/学习软件，用完就丢（类似小程序），不把时间浪费在安装软件上。例如 Redis / MongoDB / ElasticSearch / ELK

5. 多个版本软件共存，不污染系统，例如 Python2、Python3，Redis4.0，Redis5.0

####  <font color="red">重要概念：镜像、容器</font>

- 镜像

  一个镜像就是一个只读模板，指示创建容器 。大多数情况下，一个镜像会基于另一个镜像以及一些额外的自定义选项。比如，你可以构建一个基于ubuntu镜像，但是安装apache网站服务器和应用，能够像配置的一样运行起来。

  你可以创建自己的镜像或者可以仅仅使用那些已经被其它人创建发布的镜像。为了创建你自己的镜像，你需要创建一个dockerfile，使用相同的语法来定义和步骤来创建镜像并运行。

- 容器

  一个容器就是就是一个镜像的实例，你可以通过Docker API或命令行创建、启动、停止、移动或者删除。一个容器可以连接多个网络或者基于当前的状态创造更多的镜像。

  默认情况下，容器会与其它容器进行隔离，可以控制容器的网络、存储或其他底层系统。容器由镜像定义像其它配置选项一样

#### Docker的好处

1. 模块化

   Docker 容器化方法非常注重在不停止整个应用的情况下，单独截取部分应用进行更新或修复的能力。除了这种基于微服务的方法，您还可以采用与[面向服务的架构（SOA）](https://baike.baidu.com/item/SOA/2140650)类似的使用方法，在多个应用间共享进程。

2. 层和镜像版本控制

   每个 Docker 镜像文件都包含多个层。这些层组合在一起，构成单个镜像。每当镜像发生改变时，就会创建一个新的镜像层。用户每次发出命令（例如 *run* 或 *copy*）时，都会创建一个新的镜像层。

   Docker 重复使用这些层来构建新容器，借此帮助加快流程构建。镜像之间会共享中间变化，从而进一步提升速度、[规模](http://developers.redhat.com/blog/2016/03/09/more-about-docker-images-size/)以及效率。版本控制是镜像层本身自带的能力。每次发生新的更改时，您大都会获得一个内置的更改日志，实现对容器镜像的全盘管控。

3. 回滚

   回滚也许是层最值得一提的功能。每个镜像都拥有多个层。举例而言，如果您不喜欢迭代后的镜像版本，完全可以通过回滚，返回之前的版本。这一功能还支持敏捷开发方法，帮助[持续实施集成和部署（CI/CD）](https://www.redhat.com/zh/topics/devops/what-is-ci-cd)，使其在工具层面成为一种现实。

4. 快速部署

   启动和运行新硬件、实施部署并投入使用，这在过去一般需要数天时间。投入的心力和成本往往也让人不堪重负。基于 Docker 的容器可将部署时间缩短到几秒。通过为每个进程构建容器，您可以快速将这些类似进程应用到新的应用程序中。而且，由于无需启动操作系统即可添加或移动容器，因此大幅缩短了部署时间。除此之外，得益于这种部署速度，您可以轻松无虞、经济高效地创建和销毁容器创建的数据。

   因此，Docker 技术是一种更加精细、可控、基于微服务的技术，可为企业提供更高的效率价值。

####  Docker的缺点

Docker 本身非常适合用于管理单个容器。但随着您开始使用越来越多的容器和容器化应用，并把它们划分成数百个部分，很可能会导致管理和编排变得非常困难。最终，您需要后退一步，对容器实施分组，以便跨所有容器提供网络、安全、遥测等服务。于是，k8s 应运而生。

### 使用Docker安装软件

#### 传统安装软件缺点

- 安装麻烦，可能有各种依赖，需要提前安装各种东西。比如：ElasticSearch，ElK
- 部分软件并不能在所有系统完美运行，各种兼容问题，甚至无法安装。例如在Windows上安装最新redis
- 软件多版本之间不能共存
- 不同系统安装方式不一样
- 安装一堆软件，占用系统内存，拖慢电脑运行速度

#### Docker安装的优点

- 一个命令就可以安装好，快速方便
- 有大量的镜像，可直接使用
- 没有系统兼容问题，Linux 专享软件也照样跑
- 支持软件多版本共存
- 用完就丢，不拖慢电脑速度
- 不同系统和硬件，只要安装好 Docker 其他都一样了，一个命令搞定所有

#### 例：使用Docker安装Redis

`docker run -d -p 6379:6379 --name redis redis`

轻松搞定

![image-20220531084506717](https://cdn.inkdp.cn/img/20220531084506.png)

### Docker常见命令

1
